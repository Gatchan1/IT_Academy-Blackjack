# Blackjack Reactive REST API
This project is a **Spring Boot** application that allows Blackjack games creation and making moves.

It is fully reactive using Spring **WebFlux**.
It has two microservices, one that handles the games and uses **MongoDB**,
and another one that manages the player ranking and uses **MySQL** (via **R2DBC**).
There's testing implemented for the game microservice (using **JUnit** and Mockito).
Additionally, **Swagger** is used for automatic API documentation.

This was one of the two final projects for the IT Academy bootcamp in Java & Spring Framework (november 2024).
My mentor during the bootcamp was [Iván Vilaró](https://www.linkedin.com/in/ivan-vilar%C3%B3-268a30a2/).

## Technologies used
- R2DBC (Reactive Relational Database Connectivity)
- MySQL (for managing players)
- MongoDB (for game persistence)
- Spring WebFlux (reactive programming)
- Swagger/OpenAPI (for API documentation)
- Java 21
            
## Installation and configuration

### Requirements
- Java 21
- Maven 4.0+
- MySQL and MongoDB installed

### Steps
#### 1. <u>Clone repo and install dependencies</u>
Clone this repo to your computer.  
This is a **maven** project, so run the following command to install the project dependencies: `mvn clean install`.  
(Or `mvnw clean install`)
#### 2. <u>Database configuration</u>
- #### MySQL 
Notice that the default port is 3306; you can manually change it in the application.properties file:  
`spring.r2dbc.url=r2dbc:mysql://localhost:<DESIRED_PORT>/blackjackdb?serverTimezone=UTC`   

Configure MySQL credentials in the application.properties file:
```
spring.r2dbc.username=your_username
spring.r2dbc.password=your_password
```
Start the MySQL server at the specified port and create a database named `blackjackdb`.
- #### MongoDB
MongoDB should be running locally.
Collections will be automatically generated by MongoDB, so no manual setup is required.

#### 3. <u>Run the project</u>
To run the application, use the following command: `mvn spring-boot:run`  
(Or `mvnw spring-boot:run`)

The API will be available at http://localhost:8080.
                                       
### API Documentation
Once the application is running, you can access the Swagger documentation at:  
http://localhost:8080/swagger-ui.html

## Endpoints
- ### Create a new game
**URL:** `/game/new`  
**Method:** `POST`  
**Description:** Creates a new game with a list of players.

**Request Body (JSON):**
```json
[
  {
    "name": "Player1",
    "initialBet": 100
  },
  {
    "name": "Player2",
    "initialBet": 200
  }
]
```
- ### Get game details
**URL:** `/game/{id}`  
**Method:** `GET`  
**Description:** Retrieves details of a game by its ID.

**Path Parameter:** `id` (string): The unique identifier of the game.
- ### Make a move
**URL:** `/game/{id}/play`  
**Method:** `POST`  
**Description:** Submits a move in the game for the player whose turn is active. Allowed moves: `"hit"` and `"stand"`.  
**Path Parameter:** `id` (string): The unique identifier of the game.  

**Request Body (JSON):**
```json
"hit"
```
- ### Delete a game
**URL:** `/game/{id}/delete`  
**Method:** `DELETE`  
**Description:** Deletes a game by its ID.  
**Path Parameter:** `id` (string): The unique identifier of the game.
- ### Get players ranking
**URL:** `/ranking`  
**Method:** `GET`  
**Description:** Retrieves the ranking of users, sorted by score.

**Response (200 OK):**
```json
[
  {
    "rowNumber": 1,
    "userId": "user123",
    "userName": "Player1",
    "score": 160
  },
  {
    "rowNumber": 2,
    "userId": "user456",
    "userName": "Player2",
    "score": 120
  },
  ...
]
```
- ### Change a player's name
**URL:** `/player/{playerId}`  
**Method:** `PUT`  
**Description:** Changes the name of a user by their player ID.  
**Path Parameter:** `playerId` (integer): The unique identifier of the player.
